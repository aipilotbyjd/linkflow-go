type Query {
  # User queries
  me: User!
  user(id: ID!): User
  users(filter: UserFilter, pagination: PaginationInput): UserConnection!

  # Workflow queries
  workflow(id: ID!): Workflow
  workflows(filter: WorkflowFilter, pagination: PaginationInput): WorkflowConnection!
  workflowVersions(workflowId: ID!): [WorkflowVersion!]!

  # Execution queries
  execution(id: ID!): Execution
  executions(filter: ExecutionFilter, pagination: PaginationInput): ExecutionConnection!

  # Node queries
  nodeTypes: [NodeType!]!
  nodeType(type: String!): NodeType

  # Credential queries
  credentials: [Credential!]!
  credential(id: ID!): Credential
  credentialTypes: [CredentialType!]!

  # Schedule queries
  schedules(workflowId: ID): [Schedule!]!
  schedule(id: ID!): Schedule

  # Webhook queries
  webhooks(workflowId: ID): [Webhook!]!
  webhook(id: ID!): Webhook

  # Variable queries
  variables: [Variable!]!
  variable(key: String!): Variable

  # Analytics queries
  dashboard: Dashboard!
  workflowStats(workflowId: ID!, dateRange: DateRangeInput!): WorkflowStats!

  # Search
  search(query: String!, filter: SearchFilter): SearchResult!
}

type Mutation {
  # Auth mutations
  login(input: LoginInput!): AuthPayload!
  register(input: RegisterInput!): AuthPayload!
  logout: Boolean!
  refreshToken(refreshToken: String!): AuthPayload!

  # Workflow mutations
  createWorkflow(input: CreateWorkflowInput!): Workflow!
  updateWorkflow(id: ID!, input: UpdateWorkflowInput!): Workflow!
  deleteWorkflow(id: ID!): Boolean!
  activateWorkflow(id: ID!): Workflow!
  deactivateWorkflow(id: ID!): Workflow!
  duplicateWorkflow(id: ID!, name: String!): Workflow!

  # Execution mutations
  executeWorkflow(workflowId: ID!, input: JSON): Execution!
  cancelExecution(id: ID!): Execution!
  retryExecution(id: ID!): Execution!

  # Credential mutations
  createCredential(input: CreateCredentialInput!): Credential!
  updateCredential(id: ID!, input: UpdateCredentialInput!): Credential!
  deleteCredential(id: ID!): Boolean!

  # Schedule mutations
  createSchedule(input: CreateScheduleInput!): Schedule!
  updateSchedule(id: ID!, input: UpdateScheduleInput!): Schedule!
  deleteSchedule(id: ID!): Boolean!
  toggleSchedule(id: ID!, active: Boolean!): Schedule!

  # Webhook mutations
  createWebhook(input: CreateWebhookInput!): Webhook!
  deleteWebhook(id: ID!): Boolean!
  regenerateWebhookSecret(id: ID!): Webhook!

  # Variable mutations
  setVariable(key: String!, value: String!, type: VariableType): Variable!
  deleteVariable(key: String!): Boolean!
}

type Subscription {
  executionUpdated(executionId: ID!): ExecutionUpdate!
  workflowExecutions(workflowId: ID!): Execution!
  notifications: Notification!
}

# Types
type User {
  id: ID!
  email: String!
  username: String!
  firstName: String
  lastName: String
  avatar: String
  emailVerified: Boolean!
  twoFactorEnabled: Boolean!
  roles: [String!]!
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Workflow {
  id: ID!
  name: String!
  description: String
  nodes: [Node!]!
  connections: [Connection!]!
  settings: WorkflowSettings!
  status: WorkflowStatus!
  isActive: Boolean!
  version: Int!
  tags: [String!]!
  createdAt: DateTime!
  updatedAt: DateTime!
  executions(limit: Int): [Execution!]!
  schedules: [Schedule!]!
  webhooks: [Webhook!]!
}

type Node {
  id: ID!
  name: String!
  type: String!
  position: Position!
  parameters: JSON
  disabled: Boolean!
}

type Connection {
  id: ID!
  source: String!
  target: String!
  sourcePort: String
  targetPort: String
}

type Position {
  x: Float!
  y: Float!
}

type WorkflowSettings {
  timeout: Int!
  retryOnFailure: Boolean!
  maxRetries: Int!
  timezone: String!
}

type Execution {
  id: ID!
  workflowId: ID!
  workflow: Workflow!
  version: Int!
  status: ExecutionStatus!
  startedAt: DateTime
  finishedAt: DateTime
  executionTime: Int
  data: JSON
  error: String
  nodeExecutions: [NodeExecution!]!
  createdAt: DateTime!
}

type NodeExecution {
  id: ID!
  nodeId: String!
  nodeType: String!
  status: ExecutionStatus!
  startedAt: DateTime
  finishedAt: DateTime
  inputData: JSON
  outputData: JSON
  error: String
  retryCount: Int!
}

type NodeType {
  type: String!
  name: String!
  description: String
  category: String!
  icon: String
  version: String!
  schema: NodeSchema!
}

type NodeSchema {
  inputs: [SchemaField!]!
  outputs: [SchemaField!]!
}

type SchemaField {
  name: String!
  type: String!
  label: String!
  required: Boolean!
  default: JSON
}

type Credential {
  id: ID!
  name: String!
  type: String!
  description: String
  isShared: Boolean!
  lastUsedAt: DateTime
  createdAt: DateTime!
}

type CredentialType {
  type: String!
  name: String!
  description: String
  fields: [CredentialField!]!
}

type CredentialField {
  name: String!
  type: String!
  label: String!
  required: Boolean!
  sensitive: Boolean!
}

type Schedule {
  id: ID!
  name: String!
  workflowId: ID!
  cronExpression: String!
  timezone: String!
  isActive: Boolean!
  lastRunAt: DateTime
  nextRunAt: DateTime
  createdAt: DateTime!
}

type Webhook {
  id: ID!
  workflowId: ID!
  path: String!
  method: String!
  url: String!
  isActive: Boolean!
  lastCalledAt: DateTime
  callCount: Int!
  createdAt: DateTime!
}

type Variable {
  key: String!
  value: String!
  type: VariableType!
  description: String
  createdAt: DateTime!
  updatedAt: DateTime!
}

type Dashboard {
  totalWorkflows: Int!
  activeWorkflows: Int!
  totalExecutions: Int!
  successRate: Float!
  avgExecutionTime: Float!
  executionsByDay: [DailyCount!]!
  topWorkflows: [WorkflowSummary!]!
}

type DailyCount {
  date: String!
  count: Int!
  success: Int!
  failed: Int!
}

type WorkflowSummary {
  id: ID!
  name: String!
  executionCount: Int!
  successRate: Float!
}

type WorkflowStats {
  totalExecutions: Int!
  successfulExecutions: Int!
  failedExecutions: Int!
  avgExecutionTime: Float!
}

type SearchResult {
  workflows: [Workflow!]!
  total: Int!
  took: Int!
}

type AuthPayload {
  accessToken: String!
  refreshToken: String!
  expiresIn: Int!
  user: User!
}

type ExecutionUpdate {
  executionId: ID!
  status: ExecutionStatus!
  nodeId: String
  data: JSON
  timestamp: DateTime!
}

type Notification {
  id: ID!
  type: String!
  title: String!
  message: String!
  data: JSON
  createdAt: DateTime!
}

type WorkflowVersion {
  id: ID!
  version: Int!
  changedBy: ID
  changeNote: String
  createdAt: DateTime!
}

# Connections for pagination
type UserConnection {
  edges: [UserEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type UserEdge {
  node: User!
  cursor: String!
}

type WorkflowConnection {
  edges: [WorkflowEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type WorkflowEdge {
  node: Workflow!
  cursor: String!
}

type ExecutionConnection {
  edges: [ExecutionEdge!]!
  pageInfo: PageInfo!
  totalCount: Int!
}

type ExecutionEdge {
  node: Execution!
  cursor: String!
}

type PageInfo {
  hasNextPage: Boolean!
  hasPreviousPage: Boolean!
  startCursor: String
  endCursor: String
}

# Inputs
input LoginInput {
  email: String!
  password: String!
}

input RegisterInput {
  email: String!
  password: String!
  firstName: String!
  lastName: String!
}

input CreateWorkflowInput {
  name: String!
  description: String
  nodes: [NodeInput!]
  connections: [ConnectionInput!]
  tags: [String!]
}

input UpdateWorkflowInput {
  name: String
  description: String
  nodes: [NodeInput!]
  connections: [ConnectionInput!]
  tags: [String!]
}

input NodeInput {
  id: String!
  name: String!
  type: String!
  position: PositionInput!
  parameters: JSON
  disabled: Boolean
}

input ConnectionInput {
  id: String!
  source: String!
  target: String!
  sourcePort: String
  targetPort: String
}

input PositionInput {
  x: Float!
  y: Float!
}

input CreateCredentialInput {
  name: String!
  type: String!
  data: JSON!
  description: String
}

input UpdateCredentialInput {
  name: String
  data: JSON
  description: String
}

input CreateScheduleInput {
  name: String!
  workflowId: ID!
  cronExpression: String!
  timezone: String
  data: JSON
}

input UpdateScheduleInput {
  name: String
  cronExpression: String
  timezone: String
  data: JSON
}

input CreateWebhookInput {
  workflowId: ID!
  nodeId: String!
  path: String
  method: String
}

input PaginationInput {
  first: Int
  after: String
  last: Int
  before: String
}

input UserFilter {
  search: String
  status: String
}

input WorkflowFilter {
  search: String
  status: WorkflowStatus
  isActive: Boolean
  tags: [String!]
}

input ExecutionFilter {
  workflowId: ID
  status: ExecutionStatus
  dateFrom: DateTime
  dateTo: DateTime
}

input SearchFilter {
  status: WorkflowStatus
  tags: [String!]
  dateFrom: DateTime
  dateTo: DateTime
}

input DateRangeInput {
  from: DateTime!
  to: DateTime!
}

# Enums
enum WorkflowStatus {
  ACTIVE
  INACTIVE
  ERROR
}

enum ExecutionStatus {
  PENDING
  QUEUED
  RUNNING
  PAUSED
  COMPLETED
  FAILED
  CANCELLED
  TIMEOUT
}

enum VariableType {
  STRING
  NUMBER
  BOOLEAN
  SECRET
}

# Scalars
scalar DateTime
scalar JSON
